/*! @rgrove/parse-xml v4.1.0 | ISC License | Copyright Ryan Grove */var g=Object.defineProperty,k=Object.getOwnPropertyDescriptor,Y=Object.getOwnPropertyNames,J=Object.prototype.hasOwnProperty,U=(t,e)=>{for(var n in e)g(t,n,{get:e[n],enumerable:!0})},L=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Y(e))!J.call(t,r)&&r!==n&&g(t,r,{get:()=>e[r],enumerable:!(i=k(e,r))||i.enumerable});return t},$=t=>L(g({},"__esModule",{value:!0}),t),N={};U(N,{XmlCdata:()=>I,XmlComment:()=>C,XmlDeclaration:()=>D,XmlDocument:()=>S,XmlDocumentType:()=>X,XmlElement:()=>m,XmlError:()=>j,XmlNode:()=>o,XmlProcessingInstruction:()=>y,XmlText:()=>w,parseXml:()=>Z});var R=$(N),c="",q=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,F=class{constructor(t){if(this.k=this.q(t,!0),this.d=0,this.length=t.length,this.n=this.k!==this.length,this.m=t,this.n){let e=[];for(let n=0,i=0;i<this.k;++i)e[i]=n,n+=t.codePointAt(n)>65535?2:1;this.y=e}}get z(){return this.d>=this.k}q(t,e=this.n){return e?t.replace(q,"_").length:t.length}g(t=1){this.d=Math.min(this.k,this.d+t)}i(t=this.d){var e;return this.n?(e=this.y[t])!=null?e:1/0:t}F(t=1){let e=this.h(t);return this.g(t),e}G(t){if(!t.sticky)throw new Error('`regex` must have a sticky flag ("y")');t.lastIndex=this.i();let e=t.exec(this.m);if(e===null||e.length===0)return c;let n=e[0];return this.g(this.q(n)),n}v(t){let e,n=c;for(;(e=this.h())&&t(e);)n+=e,this.g();return n}Q(t){if(this.b(t))return t;if(this.n){let{length:e}=t,n=this.q(t);if(n!==e&&t===this.h(n))return this.g(n),t}return c}b(t){let{length:e}=t;return this.h(e)===t?(this.g(e),t):c}A(t){let e=this.m.slice(this.i()),n=e.search(t);if(n<=0)return c;let i=e.slice(0,n);return this.g(this.q(i)),i}t(t){let{m:e}=this,n=this.i(),i=e.indexOf(t,n);if(i<=0)return c;let r=e.slice(n,i);return this.g(this.q(r)),r}h(t=1){let{d:e,n,m:i}=this;return n?e>=this.k?c:i.slice(this.i(e),this.i(e+t)):i.slice(e,e+t)}o(t=0){this.d=t>=0?Math.min(this.k,t):Math.max(0,this.d+t)}},B=/[^"&<]+/y,V=/[^'&<]+/y,W=/\r\n|[\n\r\t]/g,z=/<|&|]]>/,G=Object.freeze(Object.assign(Object.create(null),{amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}));function T(t){let e=v(t);return e>=97&&e<=122||e>=65&&e<=90||e>=48&&e<=57||e===45||e===46||e===183||e>=768&&e<=879||e>=8255&&e<=8256||P(t,e)}function P(t,e=v(t)){return e>=97&&e<=122||e>=65&&e<=90||e===58||e===95||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039}function Q(t){return t==="#"||T(t)}function H(t){let e=v(t);return e===32||e===9||e===10||e===13}function E(t){return t===9||t===10||t===13||t>=32&&t<=55295||t>=57344&&t<=65533||t>=65536&&t<=1114111}function v(t){return t.codePointAt(0)||-1}var _=class{constructor(){this.parent=null,this.start=-1,this.end=-1}get document(){var t,e;return(e=(t=this.parent)==null?void 0:t.document)!=null?e:null}get isRootNode(){return this.parent!==null&&this.parent===this.document&&this.type===_.TYPE_ELEMENT}get preserveWhitespace(){var t;return!!((t=this.parent)!=null&&t.preserveWhitespace)}get type(){return""}toJSON(){let t={type:this.type};return this.isRootNode&&(t.isRootNode=!0),this.preserveWhitespace&&(t.preserveWhitespace=!0),this.start!==-1&&(t.start=this.start,t.end=this.end),t}},o=_;o.TYPE_CDATA="cdata";o.TYPE_COMMENT="comment";o.TYPE_DOCUMENT="document";o.TYPE_DOCUMENT_TYPE="doctype";o.TYPE_ELEMENT="element";o.TYPE_PROCESSING_INSTRUCTION="pi";o.TYPE_TEXT="text";o.TYPE_XML_DECLARATION="xmldecl";var w=class extends o{constructor(t=""){super(),this.text=t}get type(){return o.TYPE_TEXT}toJSON(){return Object.assign(o.prototype.toJSON.call(this),{text:this.text})}},I=class extends w{get type(){return o.TYPE_CDATA}},C=class extends o{constructor(t=""){super(),this.content=t}get type(){return o.TYPE_COMMENT}toJSON(){return Object.assign(o.prototype.toJSON.call(this),{content:this.content})}},D=class extends o{constructor(t,e,n){super(),this.version=t,this.encoding=e??null,this.standalone=n??null}get type(){return o.TYPE_XML_DECLARATION}toJSON(){let t=o.prototype.toJSON.call(this);t.version=this.version;for(let e of["encoding","standalone"])this[e]!==null&&(t[e]=this[e]);return t}},m=class extends o{constructor(t,e=Object.create(null),n=[]){super(),this.name=t,this.attributes=e,this.children=n}get isEmpty(){return this.children.length===0}get preserveWhitespace(){let t=this;for(;t instanceof m;){if("xml:space"in t.attributes)return t.attributes["xml:space"]==="preserve";t=t.parent}return!1}get text(){return this.children.map(t=>"text"in t?t.text:"").join("")}get type(){return o.TYPE_ELEMENT}toJSON(){return Object.assign(o.prototype.toJSON.call(this),{name:this.name,attributes:this.attributes,children:this.children.map(t=>t.toJSON())})}},S=class extends o{constructor(t=[]){super(),this.children=t}get document(){return this}get root(){for(let t of this.children)if(t instanceof m)return t;return null}get text(){return this.children.map(t=>"text"in t?t.text:"").join("")}get type(){return o.TYPE_DOCUMENT}toJSON(){return Object.assign(o.prototype.toJSON.call(this),{children:this.children.map(t=>t.toJSON())})}},X=class extends o{constructor(t,e,n,i){super(),this.name=t,this.publicId=e??null,this.systemId=n??null,this.internalSubset=i??null}get type(){return o.TYPE_DOCUMENT_TYPE}toJSON(){let t=o.prototype.toJSON.call(this);t.name=this.name;for(let e of["publicId","systemId","internalSubset"])this[e]!==null&&(t[e]=this[e]);return t}},j=class extends Error{constructor(t,e,n){let i=1,r="",s=1;for(let u=0;u<e;++u){let f=n[u];f===`
`?(i=1,r="",s+=1):(i+=1,r+=f)}let l=n.indexOf(`
`,e);r+=l===-1?n.slice(e):n.slice(e,l);let a=0;r.length>50&&(i<40?r=r.slice(0,50):(a=i-20,r=r.slice(a,i+30))),super(`${t} (line ${s}, column ${i})
  ${r}
`+" ".repeat(i-a+1)+`^
`),this.column=i,this.excerpt=r,this.line=s,this.name="XmlError",this.pos=e}},y=class extends o{constructor(t,e=""){super(),this.name=t,this.content=e}get type(){return o.TYPE_PROCESSING_INSTRUCTION}toJSON(){return Object.assign(o.prototype.toJSON.call(this),{name:this.name,content:this.content})}},p="",K=class{constructor(t,e={}){let n=this.document=new S,i=this.c=new F(t);if(this.l=n,this.f=e,this.f.includeOffsets&&(n.start=0,n.end=t.length),i.b("\uFEFF"),this.H(),!this.B())throw this.a("Root element is missing or invalid");for(;this.w(););if(!i.z)throw this.a("Extra content at the end of the document")}j(t,e){return t.parent=this.l,this.f.includeOffsets&&(t.start=this.c.i(e),t.end=this.c.i()),this.l.children.push(t),!0}x(t,e){let{children:n}=this.l,{length:i}=n;if(t=d(t),i>0){let r=n[i-1];if((r==null?void 0:r.type)===o.TYPE_TEXT){let s=r;return s.text+=t,this.f.includeOffsets&&(s.end=this.c.i()),!0}}return this.j(new w(t),e)}I(){let t=Object.create(null);for(;this.e();){let e=this.r();if(!e)break;let n=this.u()&&this.J();if(n===!1)throw this.a("Attribute value expected");if(e in t)throw this.a(`Duplicate attribute: ${e}`);if(e==="xml:space"&&n!=="default"&&n!=="preserve")throw this.a('Value of the `xml:space` attribute must be "default" or "preserve"');t[e]=n}if(this.f.sortAttributes){let e=Object.keys(t).sort(),n=Object.create(null);for(let i=0;i<e.length;++i){let r=e[i];n[r]=t[r]}t=n}return t}J(){let{c:t}=this,e=t.h();if(e!=='"'&&e!=="'")return!1;t.g();let n,i=!1,r=p,s=e==='"'?B:V;t:for(;!t.z;)switch(n=t.G(s),n&&(this.p(n),r+=n.replace(W," ")),t.h()){case e:i=!0;break t;case"&":r+=this.C();continue;case"<":throw this.a("Unescaped `<` is not allowed in an attribute value");case p:break t}if(!i)throw this.a("Unclosed attribute");return t.g(),r}K(){let{c:t}=this,e=t.d;if(!t.b("<![CDATA["))return!1;let n=t.t("]]>");if(this.p(n),!t.b("]]>"))throw this.a("Unclosed CDATA section");return this.f.preserveCdata?this.j(new I(d(n)),e):this.x(n,e)}L(){let{c:t}=this,e=t.d,n=t.A(z);if(!n)return!1;if(this.p(n),t.h(3)==="]]>")throw this.a("Element content may not contain the CDATA section close delimiter `]]>`");return this.x(n,e)}D(){let{c:t}=this,e=t.d;if(!t.b("<!--"))return!1;let n=t.t("--");if(this.p(n),!t.b("-->"))throw t.h(2)==="--"?this.a("The string `--` isn't allowed inside a comment"):this.a("Unclosed comment");return this.f.preserveComments?this.j(new C(d(n)),e):!0}M(){let t=this.c.d,e=this.C();return e?this.x(e,t):!1}N(){let{c:t}=this,e=t.d;if(!t.b("<!DOCTYPE"))return!1;let n=this.e()&&this.r();if(!n)throw this.a("Expected a name");let i,r;if(this.e()){if(t.b("PUBLIC")){if(i=this.e()&&this.O(),i===!1)throw this.a("Expected a public identifier");this.e()}if(i!==void 0||t.b("SYSTEM")){if(this.e(),r=this.s(),r===!1)throw this.a("Expected a system identifier");this.e()}}let s;if(t.b("[")){if(s=t.A(/\][\x20\t\r\n]*>/),!t.b("]"))throw this.a("Unclosed internal subset");this.e()}if(!t.b(">"))throw this.a("Unclosed doctype declaration");return this.f.preserveDocumentType?this.j(new X(n,i,r,s),e):!0}B(){let{c:t}=this,e=t.d;if(!t.b("<"))return!1;let n=this.r();if(!n)return t.o(e),!1;let i=this.I(),r=!!t.b("/>"),s=new m(n,i);if(s.parent=this.l,!r){if(!t.b(">"))throw this.a(`Unclosed start tag for element \`${n}\``);this.l=s;do this.L();while(this.B()||this.M()||this.K()||this.E()||this.D());let l=t.d,a;if(!t.b("</")||!(a=this.r())||a!==n)throw t.o(l),this.a(`Missing end tag for element ${n}`);if(this.e(),!t.b(">"))throw this.a(`Unclosed end tag for element ${n}`);this.l=s.parent}return this.j(s,e)}u(){return this.e(),this.c.b("=")?(this.e(),!0):!1}w(){return this.D()||this.E()||this.e()}r(){return P(this.c.h())?this.c.v(T):p}E(){let{c:t}=this,e=t.d;if(!t.b("<?"))return!1;let n=this.r();if(n){if(n.toLowerCase()==="xml")throw t.o(e),this.a("XML declaration isn't allowed here")}else throw this.a("Invalid processing instruction");if(!this.e()){if(t.b("?>"))return this.j(new y(n),e);throw this.a("Whitespace is required after a processing instruction name")}let i=t.t("?>");if(this.p(i),!t.b("?>"))throw this.a("Unterminated processing instruction");return this.j(new y(n,d(i)),e)}H(){let{c:t}=this,e=t.d;for(this.P();this.w(););if(this.N())for(;this.w(););return e<t.d}O(){let t=this.c.d,e=this.s();if(e!==!1&&!/^[-\x20\r\na-zA-Z0-9'()+,./:=?;!*#@$_%]*$/.test(e))throw this.c.o(t),this.a("Invalid character in public identifier");return e}C(){let{c:t}=this;if(!t.b("&"))return!1;let e=t.v(Q);if(t.F()!==";")throw this.a("Unterminated reference (a reference must end with `;`)");let n;if(e[0]==="#"){let i=e[1]==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);if(isNaN(i))throw this.a("Invalid character reference");if(!E(i))throw this.a("Character reference resolves to an invalid character");n=String.fromCodePoint(i)}else if(n=G[e],n===void 0){let{ignoreUndefinedEntities:i,resolveUndefinedEntity:r}=this.f,s=`&${e};`;if(r){let l=r(s);if(l!=null){let a=typeof l;if(a!=="string")throw new TypeError(`\`resolveUndefinedEntity()\` must return a string, \`null\`, or \`undefined\`, but returned a value of type ${a}`);return l}}if(i)return s;throw t.o(-s.length),this.a(`Named entity isn't defined: ${s}`)}return n}s(){let{c:t}=this,e=t.b('"')||t.b("'");if(!e)return!1;let n=t.t(e);if(this.p(n),!t.b(e))throw this.a("Missing end quote");return n}e(){return!!this.c.v(H)}P(){let{c:t}=this,e=t.d;if(!t.b("<?xml"))return!1;if(!this.e())throw this.a("Invalid XML declaration");let n=!!t.b("version")&&this.u()&&this.s();if(n===!1)throw this.a("XML version is missing or invalid");if(!/^1\.[0-9]+$/.test(n))throw this.a("Invalid character in version number");let i,r;if(this.e()&&(i=!!t.b("encoding")&&this.u()&&this.s(),i&&this.e(),r=!!t.b("standalone")&&this.u()&&this.s(),r)){if(r!=="yes"&&r!=="no")throw this.a('Only "yes" and "no" are permitted as values of `standalone`');this.e()}if(!t.b("?>"))throw this.a("Invalid or unclosed XML declaration");return this.f.preserveXmlDeclaration?this.j(new D(n,i||void 0,r||void 0),e):!0}a(t){let{c:e}=this;return new j(t,e.d,e.m)}p(t){let{length:e}=t;for(let n=0;n<e;++n){let i=t.codePointAt(n);if(!E(i))throw this.c.o(-([...t].length-n)),this.a("Invalid character");i>65535&&(n+=1)}}};function d(t){let e=0;for(;(e=t.indexOf("\r",e))!==-1;)t=t[e+1]===`
`?t.slice(0,e)+t.slice(e+1):t.slice(0,e)+`
`+t.slice(e+1);return t}function Z(t,e){return new K(t,e).document}function tt(t){const e=String(t),n=[],i=/\r?\n|\r/g;for(;i.test(e);)n.push(i.lastIndex);return n.push(e.length+1),{toPoint:r,toOffset:s};function r(l){let a=-1;if(typeof l=="number"&&l>-1&&l<n[n.length-1]){for(;++a<n.length;)if(n[a]>l)return{line:a+1,column:l-(a>0?n[a-1]:0)+1,offset:l}}return{line:void 0,column:void 0,offset:void 0}}function s(l){const a=l&&l.line,u=l&&l.column;if(typeof a=="number"&&typeof u=="number"&&!Number.isNaN(a)&&!Number.isNaN(u)&&a-1 in n){const f=(n[a-2]||0)+u-1||0;if(f>-1&&f<n[n.length-1])return f}return-1}}function et(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?x(t.position):"start"in t||"end"in t?x(t):"line"in t||"column"in t?b(t):""}function b(t){return O(t&&t.line)+":"+O(t&&t.column)}function x(t){return b(t&&t.start)+"-"+b(t&&t.end)}function O(t){return t&&typeof t=="number"?t:1}class h extends Error{constructor(e,n,i){const r=[null,null];let s={start:{line:null,column:null},end:{line:null,column:null}};if(super(),typeof n=="string"&&(i=n,n=void 0),typeof i=="string"){const l=i.indexOf(":");l===-1?r[1]=i:(r[0]=i.slice(0,l),r[1]=i.slice(l+1))}n&&("type"in n||"position"in n?n.position&&(s=n.position):"start"in n||"end"in n?s=n:("line"in n||"column"in n)&&(s.start=n)),this.name=et(n)||"1:1",this.message=typeof e=="object"?e.message:e,this.stack="",typeof e=="object"&&e.stack&&(this.stack=e.stack),this.reason=this.message,this.fatal,this.line=s.start.line,this.column=s.start.column,this.position=s,this.source=r[0],this.ruleId=r[1],this.file,this.actual,this.expected,this.url,this.note}}h.prototype.file="";h.prototype.name="";h.prototype.reason="";h.prototype.message="";h.prototype.stack="";h.prototype.fatal=null;h.prototype.column=null;h.prototype.line=null;h.prototype.source=null;h.prototype.ruleId=null;h.prototype.position=null;function ut(t){const e=tt(t);let n;try{n=R.parseXml(String(t),{includeOffsets:!0,preserveCdata:!0,preserveComments:!0,preserveDocumentType:!0,preserveXmlDeclaration:!0})}catch(s){const l=s;throw new h(l.message,e.toPoint(l.pos),"xast-util-from-xml:error")}const i={location:e},r=rt(n,i);return A(n,r,i),r}function nt(t){return{type:"cdata",value:t.text}}function it(t){return{type:"comment",value:t.content}}function rt(t,e){return{type:"root",children:M(t.children,e)}}function st(t){return{type:"doctype",name:t.name,public:t.publicId,system:t.systemId}}function lt(t,e){const n=M(t.children,e);return{type:"element",name:t.name,attributes:{...t.attributes},children:n}}function ot(t){return{type:"instruction",name:t.name,value:t.content}}function at(t){return{type:"text",value:t.text}}function ht(t){const e=[];return t.version&&e.push('version="'+t.version+'"'),t.encoding&&e.push('encoding="'+t.encoding+'"'),t.standalone&&e.push('standalone="'+t.standalone+'"'),{type:"instruction",name:"xml",value:e.join(" ")}}function M(t,e){const n=[];let i=-1;for(;++i<t.length;){const r=t[i];let s;r.type==="cdata"?s=nt(r):r.type==="comment"?s=it(r):r.type==="doctype"?s=st(r):r.type==="element"?s=lt(r,e):r.type==="pi"?s=ot(r):r.type==="text"?s=at(r):r.type==="xmldecl"&&(s=ht(r)),s&&(A(r,s,e),n.push(s))}return n}function A(t,e,n){const i=t.start===-1?void 0:n.location.toPoint(t.start),r=t.end===-1?void 0:n.location.toPoint(t.end);i&&r&&(e.position={start:i,end:r})}export{ut as fromXml};
